{% extends 'base.html.twig' %}

{% block title %}D√©tail de la liste - {{ liste.name }}{% endblock %}

{% block body %}
<div class="container mx-auto my-12 px-6">
    <!-- üè∑Ô∏è Nom -->
    <div class="flex items-center gap-2">
        <h1 class="text-3xl font-bold">{{ liste.name }}</h1>
        <button onclick="toggleModalName()" title="Modifier le nom" class="text-sm hover:scale-110 transition">
            ‚úèÔ∏è
        </button>
    </div>

    <!-- üìù Description -->
    <div class="mt-4 flex items-start gap-2">
        <div>
            <p class="font-semibold text-lg">Description :</p>
            <p class="text-gray-600 dark:text-gray-300">
                {{ liste.description ?: 'Aucune description fournie.' }}
            </p>
        </div>
        <button onclick="toggleModalDescription()" title="Modifier la description" class="text-sm hover:scale-110 transition">
            ‚úèÔ∏è
        </button>
    </div>

    <!-- üëÅÔ∏è Visibilit√© -->
    <div class="mt-4 flex items-center gap-2">
        <p class="font-semibold text-lg">
            Visibilit√© :
            <span class="{{ liste.isVisible ? 'text-green-600' : 'text-red-600' }}">
                {{ liste.isVisible ? 'Publique' : 'Priv√©e' }}
            </span>
        </p>
        <button onclick="toggleModalVisibility()" title="Modifier la visibilit√©" class="text-sm hover:scale-110 transition">
            ‚úèÔ∏è
        </button>
    </div>
    <p class="text-gray-600 mb-2"><strong>Date de cr√©ation :</strong> {{ liste.dateCreation|date('d/m/Y') }}</p>
    <p class="text-gray-600 mb-6"><strong>Propri√©taire :</strong> {{ liste.usser.name ?? 'Inconnu' }}</p>

    {% if liste.image %}
        <img src="{{ asset('uploads/' ~ liste.image) }}" alt="Image de la liste" class="mb-6 w-96 rounded-xl shadow-lg">
    {% endif %}

    <form method="POST" action="{{ path('liste_download_addons', { id: liste.id }) }}" data-turbo="false">
        <input type="hidden" name="_token" value="{{ csrf_token('download_addons_' ~ liste.id) }}">
        <button type="submit"
            class="mt-6 px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700 transition">
            ‚¨áÔ∏è T√©l√©charger tous les add-ons
        </button>
    </form>
    <h2 class="text-2xl font-semibold mb-3">Ajouter un Add-on √† la collection</h2>
    {% for label, messages in app.flashes %}
        {% for message in messages %}
            <div class="flash-dismissable transition-opacity duration-500 opacity-100 px-4 py-2 mb-4 rounded shadow text-white
                        {% if label == 'success' %} bg-green-500
                        {% elseif label == 'error' %} bg-red-500
                        {% elseif label == 'warning' %} bg-yellow-500
                        {% else %} bg-gray-500 {% endif %}">
                {{ message }}
            </div>
        {% endfor %}
    {% endfor %}

    <form method="POST" action="{{ path('add_addon_to_liste', { id: liste.id }) }}" class="mb-6 flex flex-col sm:flex-row gap-4 items-start sm:items-end">
        <div class="w-full sm:w-2/3">
            <label for="addon_input" class="block mb-1 text-sm font-medium text-gray-700 dark:text-gray-200">ID Blender de l‚Äôadd-on</label>
            <input type="text" name="idBlender" id="addon_input" required
                class="w-full px-4 py-2 border rounded-md bg-white text-black-950 dark:bg-black-900 dark:text-white">
        </div>
        <div>
            <input type="hidden" name="_token" value="{{ csrf_token('add_addon') }}">
            <button type="submit"
                    class="px-4 py-2 bg-emerald-600 hover:bg-emerald-700 text-white rounded-md shadow">
                ‚ûï Ajouter
            </button>
        </div>
    </form>
    <h2 class="text-2xl font-semibold mb-3">Add-ons li√©s √† cette liste</h2>

    {% if liste.addons|length > 0 %}
        <div class="overflow-x-auto">
            <table class="min-w-full bg-white border border-gray-300 rounded-lg shadow">
                <thead class="bg-gray-100 text-gray-700">
                    <tr>
                        <th class="px-4 py-2 text-left">ID</th>
                        <th class="px-4 py-2 text-left">ID Blender</th>
                        <th class="px-4 py-2 text-left">Actions</th>
                    </tr>
                </thead>
                <tbody>
                    {% for addon in liste.addons %}
                        <tr class="border-t hover:bg-gray-50">
                            <td class="px-4 py-2">{{ addon.id }}</td>
                            <td class="px-4 py-2 font-mono text-blue-700">{{ addon.idBlender }}</td>
                            <td class="px-4 py-2">
                                <form method="POST" action="{{ path('remove_addon_from_liste', { id: liste.id, addonId: addon.id }) }}" onsubmit="return confirm('Supprimer cet add-on ?')">
                                    <input type="hidden" name="_token" value="{{ csrf_token('remove_addon_' ~ addon.id) }}">
                                    <button type="submit" class="text-red-600 hover:text-red-800 text-sm font-semibold">üóëÔ∏è Supprimer</button>
                                </form>
                            </td>
                        </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    {% else %}
        <p class="text-gray-500 italic">Aucun add-on associ√© √† cette liste.</p>
    {% endif %}

    {# Modal #}
    <div id="editNameModal" class="fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center z-50 hidden">
        <div class="bg-white dark:bg-black-900 text-black dark:text-white p-6 rounded-lg w-[90%] max-w-md">
            <h2 class="text-xl font-semibold mb-4">Modifier le nom</h2>
            <form method="POST" action="{{ path('update_liste_name', { id: liste.id }) }}">
                <input type="text" name="name" value="{{ liste.name }}" class="w-full px-4 py-2 border rounded-md bg-white text-black-950" required>
                <div class="flex justify-end gap-3 mt-4">
                    <button type="button" onclick="toggleModalName()" class="px-4 py-2 bg-gray-300 dark:bg-gray-700 rounded hover:bg-gray-400 dark:hover:bg-gray-600">Annuler</button>
                    <button type="submit" class="px-4 py-2 bg-blue-500 text-white rounded hover:bg-grey-800">Enregistrer</button>
                </div>
            </form>
        </div>
    </div>
    <div id="editDescriptionModal" class="fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center z-50 hidden">
        <div class="bg-white dark:bg-black-900 text-black dark:text-white p-6 rounded-lg w-[90%] max-w-md">
            <h2 class="text-xl font-semibold mb-4">Modifier la description</h2>
            <form method="POST" action="{{ path('update_liste_description', { id: liste.id }) }}">
                <textarea name="description" rows="6" class="w-full px-4 py-2 border rounded-md bg-white text-black-950" required>{{ liste.description }}</textarea>
                <div class="flex justify-end gap-3 mt-4">
                    <button type="button" onclick="toggleModalDescription()" class="px-4 py-2 bg-gray-300 dark:bg-gray-700 rounded hover:bg-gray-400 dark:hover:bg-gray-600">Annuler</button>
                    <button type="submit" class="px-4 py-2 bg-blue-500 text-white rounded hover:bg-grey-800">Enregistrer</button>
                </div>
            </form>
        </div>
    </div>
    <div id="editVisibilityModal" class="fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center z-50 hidden">
        <div class="bg-white dark:bg-black-900 text-black dark:text-white p-6 rounded-lg w-[90%] max-w-md">
            <h2 class="text-xl font-semibold mb-4">Changer la visibilit√©</h2>
            <form method="POST" action="{{ path('update_liste_visibility', { id: liste.id }) }}">
                <select name="isVisible" class="w-full px-4 py-2 border rounded-md bg-white text-black-950" required>
                    <option value="1" {% if liste.isVisible %}selected{% endif %}>Publique</option>
                    <option value="0" {% if not liste.isVisible %}selected{% endif %}>Priv√©e</option>
                </select>
                <div class="flex justify-end gap-3 mt-4">
                    <button type="button" onclick="toggleModalVisibility()" class="px-4 py-2 bg-gray-300 dark:bg-gray-700 rounded hover:bg-gray-400 dark:hover:bg-gray-600">Annuler</button>
                    <button type="submit" class="px-4 py-2 bg-blue-500 text-white rounded hover:bg-grey-800">Enregistrer</button>
                </div>
            </form>
        </div>
    </div>
    {# JS modal #}
    <script>
        function toggleModalName() {
            document.getElementById('editNameModal').classList.toggle('hidden');
        }
        function toggleModalDescription() {
            document.getElementById('editDescriptionModal').classList.toggle('hidden');
        }
        function toggleModalVisibility() {
            document.getElementById('editVisibilityModal').classList.toggle('hidden');
        }
    </script>




</div>
{% endblock %}
