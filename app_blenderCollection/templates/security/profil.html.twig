{% extends 'base.html.twig' %}


{% set title = "Profil de " ~ user.name %}
{% set meta_description = "Consultez le profil de " ~ user.name ~ " : biographie, activités, publications et plus encore sur NomDuSite." %}

{% block og_type %}profile{% endblock %}
{# --- Directive SEO pour robots --- #} 
{% block meta_robots %}index, follow{% endblock %}

{# --- A ajouter une fois le site terminé --- #}
{# {% block og_image %}/images/og-default.jpg{% endblock %} #} 
{# {% block twitter_image %}/images/twitter-default.jpg{% endblock %} #}

{% if app.user %}
    {% set isSelf = user.id == app.user.id %}
    {% set isAdmin = 'ADMIN' in app.user.roles %}
    {% set isModo = 'MODO' in app.user.roles %}
    {% set isEditable =
        isSelf
        or (isAdmin and 'ADMIN' not in user.roles)
        or (isModo and 'ADMIN' not in user.roles and 'MODO' not in user.roles)
    %}
{% else %}
    {% set isSelf = false %}
    {% set isAdmin = false %}
    {% set isModo = false %}
    {% set isEditable = false %}
{% endif %}


{% block body %}
<section class=" bg-white-muted dark:bg-black-950 dark:text-white px-6 pt-12 pb-2 w-3/4">
    <div class="max-w-5xl mx-auto flex flex-col items-center justify-center gap-6 select-none">
        {# Boutons admin — Ban & Donner rôle Modo #}
        {% if isSelf or isAdmin or isModo %}
            <div class="fixed top-1/2 -translate-y-1/2 right-6 z-50">
                {# --- BOUTON TOGGLE (visible uniquement quand la sidebar est cachée) --- #}
                <button id="toggleSidebarBtn" class="flex items-center justify-center w-12 h-12 rounded-full bg-purple-500 hover:bg-purple-600 text-white shadow-xl transition-opacity duration-0" aria-label="Ouvrir la barre admin">
                    <svg width="23"  viewBox="0 0 46 36" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M3.4585 3.19116H43.4585M3.4585 18.1912H43.4585M3.4585 33.1912H43.4585" stroke="white" stroke-width="5" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                </button>
                {# --- SIDEBAR (même conteneur que le bouton) --- #}
                <div id="adminSidebar" class="hidden flex-col items-center justify-center gap-4 bg-grey-950/90 backdrop-blur-md border border-white/10 rounded-xl p-4 shadow-xl min-w-[180px]">
                    {# Bouton de fermeture #}
                    <button id="closeSidebarBtn" class=" py-1 self-end -mt-2 -mr-2 mb-2 text-white hover:text-purple-500 transition-colors" aria-label="Fermer la barre admin">
                        <svg width="30"  viewBox="0 0 55 55" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M33.8113 21.0279L21.3113 33.5278M21.3113 21.0278L33.8113 33.5278" stroke="currentColor" stroke-width="3.75" stroke-linecap="round"/>
                            <path d="M15.0613 5.62238C18.7385 3.49526 23.0078 2.27783 27.5613 2.27783C41.3683 2.27783 52.5613 13.4707 52.5613 27.2778C52.5613 41.0848 41.3683 52.2778 27.5613 52.2778C13.7542 52.2778 2.56128 41.0848 2.56128 27.2778C2.56128 22.7243 3.7787 18.455 5.90583 14.7778" stroke="currentColor" stroke-width="3.75" stroke-linecap="round"/>
                        </svg>
                    </button>
                    <div class="flex flex-col gap-4">
                        {% if (isAdmin or isModo) and not isSelf %}
                            <form method="POST" action="{{ path('admin_set_lock', {id: user.id}) }}"
                                data-confirm="Verrouiller cet utilisateur bloquera son accès. Es-tu certain de cette décision ?">
                                <input type="hidden" name="_token" value="{{ csrf_token('set_lock_' ~ user.id) }}">
                                <button  class="flex items-center gap-3 px-4 py-2 w-full rounded-lg bg-grey-900 hover:bg-grey-800 text-white transition-transform hover:scale-[1.02]">
                                    <svg width="15" viewBox="0 0 46 61" fill="none" xmlns="http://www.w3.org/2000/svg">
                                        <path fill-rule="evenodd" clip-rule="evenodd" d="M8.4585 22.6912V15.1912C8.4585 6.90689 15.1742 0.191162 23.4585 0.191162C31.7426 0.191162 38.4585 6.90689 38.4585 15.1912V22.6912H45.9585V60.1912H0.958496V22.6912H8.4585ZM15.9585 15.1912C15.9585 11.049 19.3164 7.69116 23.4585 7.69116C27.6006 7.69116 30.9585 11.049 30.9585 15.1912V22.6912H15.9585V15.1912ZM19.7085 48.9412V33.9412H27.2085V48.9412H19.7085Z" fill="white"/>
                                    </svg>
                                    <span class="text-sm font-medium">Verrouiller</span>
                                </button>
                            </form>
                            <form method="POST" action="{{ path('admin_set_ban', {id: user.id}) }}"
                                data-confirm="⚠️ Es-tu sûr de vouloir bannir cet utilisateur ? Cette action est irréversible.">
                                <input type="hidden" name="_token" value="{{ csrf_token('set_ban_' ~ user.id) }}">
                                <button class="flex items-center gap-3 px-4 py-2 w-full rounded-lg bg-black-900 hover:bg-black-950 text-white transition-transform hover:scale-[1.02]">
                                    <svg width="25"  viewBox="0 0 60 60" fill="none" xmlns="http://www.w3.org/2000/svg">
                                        <path d="M30.0004 0C13.4585 0 0.000732422 13.4585 0.000732422 30.0015C0.00237212 46.5428 13.4601 60 30.0004 60C46.5419 60 59.9993 46.5426 59.9993 30.0011C59.9993 13.4585 46.5419 0 30.0004 0ZM30.0004 5.46568C35.782 5.46568 41.1017 7.47741 45.2997 10.8361L10.8363 45.2992C7.47832 41.1015 5.46695 35.7821 5.46641 30.0013C5.46641 16.4723 16.4723 5.46568 30.0004 5.46568ZM30.0004 54.5343C24.219 54.5343 18.8989 52.5226 14.7007 49.1639L49.1645 14.701C52.5224 18.8992 54.5338 24.2193 54.5338 30.0011C54.5336 43.5288 43.5281 54.5343 30.0004 54.5343Z" fill="white"/>
                                    </svg>
                                    <span class="text-sm font-medium">Bannir</span>
                                </button>
                            </form>
                            <form method="POST" action="{{ path('admin_reset_roles', {id: user.id}) }}"
                                data-confirm="⚠️ Tous les rôles de cet utilisateur seront supprimés. Veux-tu vraiment continuer ?">
                                <input type="hidden" name="_token" value="{{ csrf_token('reset_roles_' ~ user.id) }}">
                                <button class="flex items-center gap-3 px-4 py-2 w-full rounded-lg bg-blue-600 hover:bg-blue-500 text-white transition-transform hover:scale-[1.02]">
                                    <svg width="25"  viewBox="0 0 60 60" fill="none" xmlns="http://www.w3.org/2000/svg">
                                        <g clip-path="url(#clip0_100_23)">
                                        <path fill-rule="evenodd" clip-rule="evenodd" d="M30 0V6.66666C42.8633 6.66666 53.3333 17.1333 53.3333 30C53.3333 42.8667 42.8633 53.3333 30 53.3333C17.1367 53.3333 6.66666 42.8667 6.66666 30C6.66666 23.8433 9.11666 18.0467 13.3333 13.7267V21.6667H20V3.33334H1.66666V10H7.63666C2.77 15.44 0 22.53 0 30C0 46.54 13.4567 60 30 60C46.5433 60 60 46.54 60 30C60 13.46 46.5433 0 30 0Z" fill="white"/>
                                        </g>
                                        <defs>
                                        <clipPath id="clip0_100_23">
                                        <rect width="60" height="60" fill="white"/>
                                        </clipPath>
                                        </defs>
                                    </svg>
                                    <span class="text-sm font-medium">Reset rôles</span>
                                </button>
                            </form>
                        {% endif %}
                        {% if isAdmin and not isSelf %}
                            <form method="POST" action="{{ path('admin_give_modo', {id: user.id}) }}"
                                data-confirm="Confirme-tu vouloir accorder le rôle de modérateur à cet utilisateur ?">
                                <input type="hidden" name="_token" value="{{ csrf_token('give_modo_' ~ user.id) }}">
                                <button  class="flex items-center gap-3 px-4 py-2 w-full rounded-lg bg-purple-500 hover:bg-purple-600 text-white transition-transform hover:scale-[1.02]">
                                    <svg width="20" viewBox="0 0 38 60" fill="none" xmlns="http://www.w3.org/2000/svg">
                                        <path d="M35.1496 43.4674C34.0703 40.8253 32.5774 38.3612 30.7563 36.2972C32.7794 33.7479 33.9833 30.5201 33.9918 27.0032C33.9833 24.471 33.3549 22.088 32.2457 20.0009V5.43012C32.2457 4.49566 32.001 3.5877 31.4604 2.87238C30.9276 2.14781 30.1415 1.66687 29.2778 1.42301C28.2036 1.11691 26.7456 0.758789 25.0081 0.48C23.262 0.200391 21.2371 0 19.0017 0C14.5315 0 10.8824 0.803086 8.71693 1.42301C7.8617 1.66687 7.07561 2.1477 6.54369 2.87238C6.00229 3.58781 5.7576 4.49578 5.7576 5.43012V19.9837C4.63986 22.0794 4.0115 24.4624 4.0115 27.0032C4.0115 30.5218 5.21619 33.7505 7.24108 36.3006C5.4208 38.3639 3.92865 40.8271 2.85029 43.4674C1.63283 46.4531 0.940489 49.6657 0.938731 52.7973C0.93709 53.458 1.13572 54.0949 1.45717 54.6432C2.02494 55.6066 2.9185 56.345 4.01748 56.9862C5.67228 57.941 7.84811 58.6743 10.4026 59.1935C12.9551 59.7093 15.8828 60 18.9999 60C23.7531 59.9974 28.0552 59.3307 31.2806 58.1993C32.8937 57.6289 34.2442 56.9494 35.2733 56.0977C35.7856 55.6704 36.2221 55.1947 36.5436 54.6431C36.8642 54.0949 37.0627 53.458 37.0611 52.7972C37.0604 49.6658 36.3671 46.4532 35.1496 43.4674ZM8.37498 10.8688C8.38354 10.8688 8.39291 10.8782 8.40147 10.8782C8.72455 10.983 9.12615 11.0965 9.58904 11.2012C10.5056 11.4101 11.649 11.5935 12.8187 11.7417C15.159 12.0393 17.6733 12.2047 18.9999 12.2047C20.746 12.2047 24.5179 11.9251 27.2938 11.4196C28.2199 11.2618 29.0315 11.07 29.5993 10.8782C29.6077 10.8782 29.6164 10.8688 29.6248 10.8688V13.5928C29.4244 13.6542 29.2062 13.7062 28.9879 13.7505C27.94 13.9859 26.7439 14.1776 25.5127 14.3354C23.0513 14.6493 20.5106 14.8154 18.9998 14.824C17.0269 14.8154 13.2466 14.5358 10.2438 14.0038C9.57111 13.881 8.94275 13.7507 8.37486 13.5928V10.8688H8.37498ZM18.9999 55.6057C17.8306 55.6057 16.8829 54.6585 16.8829 53.4887C16.8829 52.3189 17.8306 51.3717 18.9999 51.3717C20.1693 51.3717 21.1169 52.3189 21.1169 53.4887C21.1169 54.6585 20.1693 55.6057 18.9999 55.6057ZM18.9999 48.6213C17.8306 48.6213 16.8829 47.6741 16.8829 46.5043C16.8829 45.3346 17.8306 44.3873 18.9999 44.3873C20.1693 44.3873 21.1169 45.3345 21.1169 46.5043C21.1169 47.6741 20.1693 48.6213 18.9999 48.6213ZM19.0017 39.3742C15.5794 39.3742 12.4973 37.9946 10.2542 35.7506C8.01861 33.5075 6.63065 30.4254 6.63065 27.0032C6.63065 25.1871 7.02369 23.4675 7.7219 21.9132C8.44658 22.1579 9.3017 22.3412 10.2447 22.5159C13.2483 23.048 17.0203 23.3276 19.0017 23.3276C20.5124 23.3276 23.0522 23.1614 25.5146 22.8476C26.7458 22.6898 27.9419 22.498 28.9897 22.2627C29.4517 22.1664 29.8798 22.0529 30.2728 21.9131C30.9796 23.4674 31.364 25.1871 31.3727 27.003C31.3641 30.4253 29.9847 33.5074 27.7501 35.7505C25.506 37.9947 22.4239 39.3742 19.0017 39.3742Z" fill="white"/>
                                    </svg>
                                    <span class="text-sm font-medium">Donner Modo</span>
                                </button>
                            </form>
                        {% endif %}
                        {% if isSelf or isAdmin or isModo %}
                            <form method="POST" action="{{ path('delete_account', { id: user.id }) }}"
                                data-confirm="⚠️ Es-tu sûr de vouloir supprimer ton compte ? Cette action est irréversible.">
                                <input type="hidden" name="_token" value="{{ csrf_token('delete_account_' ~ user.id) }}">
                                <button type="submit"
                                    class="mt-4 flex items-center gap-3 px-4 py-2 w-full rounded-lg bg-red-600 hover:bg-red-700 text-white font-medium transition-transform hover:scale-[1.02] duration-200">
                                    <svg width="25"  viewBox="0 0 46 50" fill="none" xmlns="http://www.w3.org/2000/svg">
                                        <path d="M18 25L28 35M28 25L18 35M3 10H43M33 10L32.3235 7.97017C31.6677 6.00312 31.3398 5.0196 30.7318 4.29245C30.1948 3.65032 29.5052 3.1533 28.7262 2.84695C27.844 2.5 26.8075 2.5 24.734 2.5H21.266C19.1925 2.5 18.156 2.5 17.2738 2.84695C16.4948 3.1533 15.8052 3.65032 15.2682 4.29245C14.6601 5.0196 14.3323 6.00312 13.6766 7.97017L13 10M38 10V35.5C38 39.7005 38 41.8005 37.1825 43.405C36.4635 44.8162 35.3162 45.9635 33.905 46.6825C32.3005 47.5 30.2005 47.5 26 47.5H20C15.7996 47.5 13.6994 47.5 12.0951 46.6825C10.6839 45.9635 9.5365 44.8162 8.81745 43.405C8 41.8005 8 39.7005 8 35.5V10" stroke="white" stroke-width="5" stroke-linecap="round" stroke-linejoin="round"/>
                                    </svg>
                                    <span class="text-sm">Supprimer Compte</span>
                                </button>
                            </form>
                        {% endif %}
                    </div>
                </div>
            </div>
        {% endif %}
        {# Modal #}
        <div id="customConfirmModal"
            class="fixed inset-0 z-[100] bg-black-990/70 backdrop-blur-sm flex items-center justify-center hidden">
        <div class="bg-grey-950 border border-white/10 rounded-xl p-6 w-full max-w-sm text-white shadow-2xl relative">
            
            <p id="confirmMessage" class="text-white text-sm mb-6">
            Es-tu sûr de vouloir effectuer cette action ?
            </p>

            <div class="flex justify-end gap-3">
            <button id="cancelConfirm"
                    class="px-4 py-2 rounded bg-grey-800 hover:bg-grey-900 text-white text-sm">
                Annuler
            </button>
            <button id="confirmAction"
                    class="px-4 py-2 rounded bg-purple-500 hover:bg-purple-600 text-white text-sm">
                Confirmer
            </button>
            </div>
        </div>
        </div>

            <!-- Avatar -->
            <form id="upload-avatar-form" method="POST" enctype="multipart/form-data" action="{{ path('app_update_avatar', { id: user.id }) }}">
                <input id="avatar-input" type="file" name="avatar" accept="image/*" class="hidden" onchange="document.getElementById('upload-avatar-form').submit()">
                <label for="avatar-input" class=" sr-only">Image de Profile</label>
                {% if isEditable %}
                    <div class="group relative w-96 h-96 md:w-56 md:h-56 rounded-full overflow-hidden border-4 dark:border-white border-black-950 cursor-pointer" onclick="document.getElementById('avatar-input').click()">
                        {% if user.pathImg %}
                            <img src="{{ user.pathImg }}" alt="Avatar" class="transition duration-150 group-hover:blur-sm w-full h-full object-cover">
                        {% else %}
                            <img src="/img/profil_template.png" alt="Default avatar" class="transition duration-150 group-hover:blur-sm w-full h-full object-cover">
                        {% endif %}
                        <div class="absolute inset-0 bg-black bg-opacity-50 flex items-center justify-center opacity-0 hover:opacity-100 transition-opacity duration-300 text-black-990 ">
                            <span class="{#  text-sm font-semibold p-2 dark:bg-black-950 dark:text-white rounded-full bg-white #}">
                                <svg width="65" viewBox="0 0 51 41" fill="none" xmlns="http://www.w3.org/2000/svg">
                                    <path d="M10.4585 2.69116H35.4585C36.7846 2.69116 38.0563 3.21795 38.994 4.15563C39.9317 5.09331 40.4585 6.36508 40.4585 7.69116V25.1912" stroke="currentColor" stroke-width="5" stroke-linecap="round" stroke-linejoin="round"/>
                                    <path d="M40.4585 37.6912H15.4585C14.1324 37.6912 12.8606 37.1644 11.923 36.2267C10.9853 35.289 10.4585 34.0172 10.4585 32.6912V15.1912" stroke="currentColor" stroke-width="5" stroke-linecap="round" stroke-linejoin="round"/>
                                    <path d="M32.9585 17.6912L40.4585 25.1912L47.9585 17.6912" stroke="currentColor" stroke-width="5" stroke-linecap="round" stroke-linejoin="round"/>
                                    <path d="M17.9585 22.6912L10.4585 15.1912L2.9585 22.6912" stroke="currentColor" stroke-width="5" stroke-linecap="round" stroke-linejoin="round"/>
                                </svg>
                            </span>
                        </div>
                    </div>
                {% else %}
                    <div class="relative w-32 h-32 rounded-full overflow-hidden border-4 dark:border-white border-black-950 cursor-pointer" >
                        {% if user.pathImg %}
                            <img src="{{ user.pathImg }}" alt="Avatar" class="transition duration-150 group-hover:blur-sm w-full h-full object-cover">
                        {% else %}
                            <img src="/img/profil_template.png" alt="Default avatar" class="transition duration-150 group-hover:blur-sm w-full h-full object-cover">
                        {% endif %}
                    </div>
                {% endif %}
            </form>         
            
            <div class="text-center flex flex-col gap-2">
                <!-- Nom + Email + Role -->
                <div class=" flex flex-col gap-4 justify-center items-center">
                    {# Nom #}
                    <div class="flex items-center gap-4 px-4 py-2 bg-grey-900 dark:bg-grey-950 rounded-xl shadow-sm max-w-fit justify-center">
                        <h1 class="text-xl font-semibold text-white truncate max-w-[200px] sm:max-w-xs md:max-w-sm">
                            {{ user.name }}
                        </h1>                        
                        {% if isEditable %}
                            <button
                            class="w-9 h-9 flex items-center justify-center rounded-full bg-purple-500 hover:bg-purple-600 active:bg-purple-700 text-white transition-all duration-200 shadow-sm hover:shadow-md focus:outline-none focus:ring-2 focus:ring-purple-500/50 open-modal-btn"
                            data-title="Modifier le nom"
                            data-action="{{ path('app_update_name', { id: user.id }) }}"
                            data-field-name="name"
                            aria-label="Button d'édition du Nom"
                            data-value="{{ user.name|e('html_attr') }}">
                                <svg width="20" viewBox="0 0 55 55" fill="none" xmlns="http://www.w3.org/2000/svg" class="text-white">
                                    <path d="M50.1997 14.0001L26.3497 37.85C23.9747 40.225 16.9247 41.325 15.3497 39.75C13.7747 38.175 14.8497 31.125 17.2247 28.75L41.0998 4.87505C41.6885 4.2327 42.4013 3.71635 43.1953 3.3571C43.989 2.99785 44.8475 2.8031 45.7187 2.78475C46.5897 2.76643 47.4558 2.92478 48.264 3.2503C49.0723 3.57583 49.8063 4.06183 50.4215 4.67883C51.0368 5.29583 51.5207 6.03107 51.844 6.84022C52.1672 7.6494 52.3235 8.51565 52.3027 9.38677C52.282 10.2579 52.0848 11.1159 51.7235 11.9087C51.362 12.7016 50.8437 13.4131 50.1997 14.0001Z" stroke="currentColor" stroke-width="3.75" stroke-linecap="round" stroke-linejoin="round"/>
                                    <path d="M24.5 8H12C9.34782 8 6.80445 9.05355 4.92907 10.9289C3.05372 12.8043 2 15.3478 2 18V43C2 45.6522 3.05372 48.1957 4.92907 50.071C6.80445 51.9465 9.34782 53 12 53H39.5C45.025 53 47 48.5 47 43V30.5" stroke="currentColor" stroke-width="3.75" stroke-linecap="round" stroke-linejoin="round" />
                                </svg>
                            </button>
                        {% endif %}
                    </div>
                    {# Email #}
                    <div class="flex items-center gap-4 px-4 py-2 bg-grey-900 dark:bg-grey-950 rounded-xl shadow-sm max-w-fit">
                        <p class="text-xl font-semibold text-white truncate max-w-[200px] sm:max-w-xs md:max-w-sm">
                            {{ user.email }}
                        </p>                        
                        {% if isEditable %}
                            <button
                            class="w-9 h-9 flex items-center justify-center rounded-full bg-purple-500 hover:bg-purple-600 active:bg-purple-700 text-white transition-all duration-200 shadow-sm hover:shadow-md focus:outline-none focus:ring-2 focus:ring-purple-500/50 open-modal-btn"
                                data-title="Modifier l'adresse mail"
                                data-action="{{ path('app_update_email', { id: user.id }) }}"
                                data-field-name="email"
                                aria-label="Button d'édition du Email"
                                data-value="{{ user.email|e('html_attr') }}">
                                <svg width="20" viewBox="0 0 55 55" fill="none" xmlns="http://www.w3.org/2000/svg" class="text-white">
                                    <path d="M50.1997 14.0001L26.3497 37.85C23.9747 40.225 16.9247 41.325 15.3497 39.75C13.7747 38.175 14.8497 31.125 17.2247 28.75L41.0998 4.87505C41.6885 4.2327 42.4013 3.71635 43.1953 3.3571C43.989 2.99785 44.8475 2.8031 45.7187 2.78475C46.5897 2.76643 47.4558 2.92478 48.264 3.2503C49.0723 3.57583 49.8063 4.06183 50.4215 4.67883C51.0368 5.29583 51.5207 6.03107 51.844 6.84022C52.1672 7.6494 52.3235 8.51565 52.3027 9.38677C52.282 10.2579 52.0848 11.1159 51.7235 11.9087C51.362 12.7016 50.8437 13.4131 50.1997 14.0001Z" stroke="currentColor" stroke-width="3.75" stroke-linecap="round" stroke-linejoin="round"/>
                                    <path d="M24.5 8H12C9.34782 8 6.80445 9.05355 4.92907 10.9289C3.05372 12.8043 2 15.3478 2 18V43C2 45.6522 3.05372 48.1957 4.92907 50.071C6.80445 51.9465 9.34782 53 12 53H39.5C45.025 53 47 48.5 47 43V30.5" stroke="currentColor" stroke-width="3.75" stroke-linecap="round" stroke-linejoin="round" />
                                </svg>
                            </button>
                        {% endif %}
                    </div>
                    {# Role + Verification #}
                    <div class=" flex flex-row font-thin text-grey-500 mb-2 gap-1 justify-center items-center text-center">
                        <div class="bg-white dark:bg-black-950 flex flex-wrap items-center gap-2 px-4 py-2  rounded-xl shadow-sm max-w-fit">
                            {% if user.roles %}
                                {% for role in user.roles %}
                                    {% if role == 'ROLE_USER' %}
                                        {% set role = 'Membre' %}
                                    {% endif %}
                                    {% if role != 'USER' %}
                                        <span class="px-2 py-1 rounded border border-grey-500 text-xs text-grey-400">{{ role|lower|capitalize }}</span>
                                    {% endif %}
                                {% endfor %}
                            {% endif %}
                        </div>
                        <div>
                            {% if user.isVerified %}
                                <span class="inline-flex items-center gap-2 px-3 py-1 rounded-full text-xs font-semibold bg-blue-600/10 text-blue-600 border border-blue-600">
                                    <svg width="14" height="14" fill="currentColor" viewBox="0 0 20 20">
                                        <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.707a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414L9 13.414l4.707-4.707z" clip-rule="evenodd"/>
                                    </svg>
                                    Vérifié
                                </span>
                            {% else %}
                                <span class="inline-flex items-center gap-2 px-3 py-1 rounded-full text-xs font-semibold bg-yellow-500/10 text-yellow-400 border border-yellow-400">
                                    <svg width="14" height="14" fill="currentColor" viewBox="0 0 20 20">
                                        <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm-1-5h2v2h-2v-2zm0-8h2v6h-2V5z" clip-rule="evenodd"/>
                                    </svg>
                                    Non vérifié
                                </span>
                            {% endif %}
                        </div>

                    </div>
                    <div class="flex flex-row font-thin text-grey-500 mb-2 gap-1 justify-center items-center text-center">
                        <div class="max-w-2xl mx-auto mt-6 text-black-950 dark:text-white bg-white dark:bg-black-900 p-6 rounded-lg shadow text-left">
                            <div class="flex flex-row items-center gap-2 mb-4">
                                <p class="text-xl font-semibold dark:text-white text-black-950 truncate max-w-[200px] sm:max-w-xs md:max-w-sm">
                                    Description
                                </p>                        
                                {% if isEditable %}
                                    <button
                                    class="w-9 h-9 flex items-center justify-center rounded-full bg-purple-500 hover:bg-purple-600 active:bg-purple-700 text-white transition-all duration-200 shadow-sm hover:shadow-md focus:outline-none focus:ring-2 focus:ring-purple-500/50 open-modal-btn"
                                        data-title="Modifier la description"
                                        data-action="{{ path('app_update_description', { id: user.id }) }}"
                                        data-field-name="description"
                                        aria-label="Button d'édition de la description"
                                        data-value="{{ user.description|e('html_attr') }}"
                                        role="button"
                                        title="Modifier la description">
                                        <svg width="20" viewBox="0 0 55 55" fill="none" xmlns="http://www.w3.org/2000/svg" class="text-white">
                                            <path d="M50.1997 14.0001L26.3497 37.85C23.9747 40.225 16.9247 41.325 15.3497 39.75C13.7747 38.175 14.8497 31.125 17.2247 28.75L41.0998 4.87505C41.6885 4.2327 42.4013 3.71635 43.1953 3.3571C43.989 2.99785 44.8475 2.8031 45.7187 2.78475C46.5897 2.76643 47.4558 2.92478 48.264 3.2503C49.0723 3.57583 49.8063 4.06183 50.4215 4.67883C51.0368 5.29583 51.5207 6.03107 51.844 6.84022C52.1672 7.6494 52.3235 8.51565 52.3027 9.38677C52.282 10.2579 52.0848 11.1159 51.7235 11.9087C51.362 12.7016 50.8437 13.4131 50.1997 14.0001Z" stroke="currentColor" stroke-width="3.75" stroke-linecap="round" stroke-linejoin="round"/>
                                            <path d="M24.5 8H12C9.34782 8 6.80445 9.05355 4.92907 10.9289C3.05372 12.8043 2 15.3478 2 18V43C2 45.6522 3.05372 48.1957 4.92907 50.071C6.80445 51.9465 9.34782 53 12 53H39.5C45.025 53 47 48.5 47 43V30.5" stroke="currentColor" stroke-width="3.75" stroke-linecap="round" stroke-linejoin="round" />
                                        </svg>
                                    </button>
                                {% endif %}
                            </div>

                            <div class="prose dark:prose-invert max-w-none">
                                {% if user.description %}
                                    {{ descriptionHtml|raw }}
                                {% else %}
                                    <p class="italic text-sm text-grey-500">Pas de description renseignée.</p>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                </div>
            </div>

        <!-- Modal d'Édition Générique -->
        <div id="genericEditModal" class="fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center z-50 hidden">
            <div class="bg-white dark:bg-black-900 text-black dark:text-white p-6 rounded-lg w-[90%] max-w-md">
                <h2 id="genericModalTitle" class="text-xl font-semibold mb-4">Titre</h2>
                <form method="POST" action="">
                    <!-- Champ inséré dynamiquement ici -->
                    <div id="genericModalField"></div>

                    <div class="flex justify-end gap-3 mt-4">
                        <button type="button" onclick="document.getElementById('genericEditModal').classList.add('hidden')"
                                class="px-4 py-2 bg-gray-300 dark:bg-gray-700 rounded hover:bg-gray-400 dark:hover:bg-gray-600">
                            Annuler
                        </button>
                        <button type="submit"
                                class="px-4 py-2 bg-blue-500 text-white rounded hover:bg-grey-800">
                            Enregistrer
                        </button>
                    </div>
                </form>
            </div>
        </div>


</section>


<section class=" bg-white-muted dark:bg-black-950 dark:text-white px-6 pb-12 w-3/4">

    <!-- Séparateur -->
    <div class="w-full h-px bg-grey-500 opacity-30 my-6"></div>

    <!-- Section des commentaires -->
    <div class="w-full flex items-center gap-3 mb-4">
        <svg width="25" class="dark:text-white text-black-950" viewBox="0 0 60 57" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path fill-rule="evenodd" clip-rule="evenodd" d="M60 0.75H0V45.75H18.75L30 57L41.25 45.75H60V0.75ZM11.25 19.5H18.75V27H11.25V19.5ZM33.75 19.5H26.25V27H33.75V19.5ZM48.75 19.5H41.25V27H48.75V19.5Z" fill="currentColor"/>
        </svg>
        <h2 class="text-xl sm:text-2xl font-semibold dark:text-white text-black-950">Commentaires rédigés</h2>
    </div>

    {% set hasComments = user.posts|length > 0 or user.reponse|length > 0 %}

    {% if hasComments %}
        <!-- Section Commentaires -->
        <div class="w-full flex flex-col gap-6">
            {# Commentaires directs #}
            <div>
                <h3 class="text-lg font-semibold text-white mb-2">Commentaires</h3>
                <div class="grid sm:grid-cols-2 lg:grid-cols-3 gap-4">
                    {% for comment in user.posts|sort((a, b) => b.dateCreation <=> a.dateCreation) %}
                        <div class="bg-grey-900 dark:bg-black-900 rounded-xl shadow-md hover:shadow-lg transition-shadow p-4 flex flex-col justify-between h-full text-white">
                            <div class="flex flex-col gap-2 mb-2">
                                <div class="flex justify-between items-center text-xs text-grey-500">
                                    <p>
                                        Sur :
                                        <a href="{{ path('liste_show', { id: comment.commentaire.id }) }}"
                                        class="text-blue-600 hover:underline hover:text-blue-400 transition-colors">
                                            {{ comment.commentaire.name ?? 'Collection #' ~ comment.commentaire.id }}
                                        </a>
                                    </p>
                                    <span class="italic">{{ comment.dateCreation|date('d/m/Y H:i') }}</span>
                                </div>
                                <div class="text-sm text-grey-300 line-clamp-5 leading-snug">
                                    {{ comment.content }}
                                </div>
                            </div>
                            <div class="flex justify-end">
                                <span class="px-2 py-1 rounded-full text-xs bg-blue-600/10 text-blue-600 border border-blue-500">
                                    Commentaire
                                </span>
                            </div>
                        </div>
                    {% endfor %}
                </div>
            </div>

            {# Réponses #}
            <div>
                <h3 class="text-lg font-semibold text-white mb-2">Réponses</h3>
                <div class="grid sm:grid-cols-2 lg:grid-cols-3 gap-4">
                    {% for reply in user.reponse|sort((a, b) => b.dateCreation <=> a.dateCreation) %}
                        <div class="bg-grey-900 dark:bg-black-900 rounded-xl shadow-md hover:shadow-lg transition-shadow p-4 flex flex-col justify-between h-full text-white">
                            <div class="flex flex-col gap-2 mb-2">
                                <div class="flex justify-between items-center text-xs text-grey-500">
                                    <p>
                                        En réponse à :
                                        <a href="{{ path('liste_show', { id: reply.post.commentaire.id }) }}"
                                        class="text-blue-600 hover:underline hover:text-blue-400 transition-colors">
                                            {{ reply.post.commentaire.name ?? 'Collection #' ~ reply.post.commentaire.id }}
                                        </a>
                                    </p>
                                    <span class="italic">{{ reply.dateCreation|date('d/m/Y H:i') }}</span>
                                </div>
                                <div class="text-sm text-grey-300 line-clamp-5 leading-snug">
                                    {{ reply.content }}
                                </div>
                            </div>
                            <div class="flex justify-end">
                                <span class="px-2 py-1 rounded-full text-xs bg-green-600/10 text-green-500 border border-green-600">
                                    Réponse
                                </span>
                            </div>
                        </div>
                    {% endfor %}
                </div>
            </div>
        </div>
    {% else %}
        <p class="text-sm italic text-grey-500">Aucun commentaire rédigé pour le moment.</p>
    {% endif %}


    <!-- Séparateur -->
    <div class="w-full h-px bg-grey-500 opacity-30 my-6"></div>
    
    <!-- Collections créées -->
    <div class="w-full flex justify-between items-center mb-4">
        <h2 class="text-xl sm:text-2xl font-semibold dark:text-white text-black-950">Collections créées</h2>
    </div>

    {% if user.listes is not empty %}
        <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-6 w-full ">
            {% for collection in user.listes|sort((a, b) => b.dateCreation <=> a.dateCreation) %}
                <div class=" truncate bg-grey-900 dark:bg-black-900 p-4 rounded-xl shadow-md hover:shadow-lg transition-shadow duration-300 flex flex-col justify-between text-white tilt-card">
                    <div>
                        <a href="{{ path('liste_show', { id: collection.id }) }}">
                            <img src="{{ asset('uploads/' ~ collection.image) }}"
                                alt="{{ collection.name }}"
                                class="rounded-lg mb-3 h-32 w-full object-cover shadow-sm border border-grey-800 hover:opacity-90 transition-opacity duration-200">
                        </a>
                            <a href="{{ path('liste_show', { id: collection.id }) }}"
                            class="block w-fit transition-colors relative after:content-[''] after:absolute after:left-0 after:-bottom-0.5 after:h-0.5 after:w-0 after:bg-purple-500 after:transition-all after:duration-300 hover:after:w-full hover:text-purple-500 active:scale-95 active:after:bg-purple-600">
                                <h3 class="text-2xl font-bold mb-2 truncate text-white hover:text-purple-500 active:text-purple-600">
                                    {{ collection.name }}
                                </h3>
                            </a>
                        <p class="text-xs italic text-grey-400">
                            Par 
                            {% if collection.usser is not null %}
                                <a href="{{ path('app_profil_visiteur', { id: collection.usser.id }) }}"
                                class="text-blue-600 hover:underline hover:text-blue-400 transition-colors">
                                    {{ collection.usser.name }}
                                </a>
                            {% else %}
                                <span class="text-red-400 italic">Utilisateur supprimé</span>
                            {% endif %}
                        </p>
                        <p class="text-sm text-grey-400 truncate">
                            {{ collection.description|default('Aucune description') }}
                        </p>
                    </div>

                    <div class="mt-4 flex justify-between text-xs text-grey-500">
                        <span>{{ collection.dateCreation|date('d/m/Y') }}</span>
                        <span>{{ collection.favorisCount }} favoris</span>
                    </div>
                </div>
            {% endfor %}
        </div>
    {% else %}
        <p class="text-sm italic text-grey-400">Aucune collection créée pour le moment.</p>
    {% endif %}

    <!-- Séparateur -->
    <div class="w-full h-px bg-grey-500 opacity-30 my-6"></div>

    <!-- Collections en favoris -->
    <div class="w-full flex justify-between items-center mb-4">
        <h2 class="text-xl sm:text-2xl font-semibold dark:text-white text-black-950">Collections en favoris</h2>
    </div>

    {% if user.favoris is not empty %}
        <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-6 w-full">
            {% for collection in user.favoris|sort((a, b) => b.dateCreation <=> a.dateCreation) %}
                <div class=" truncate bg-grey-900 dark:bg-black-900 p-4 rounded-xl shadow-md hover:shadow-lg transition-shadow duration-300 flex flex-col justify-between text-white tilt-card">
                    <div>
                        <a href="{{ path('liste_show', { id: collection.id }) }}">
                            <img src="{{ asset('uploads/' ~ (collection.image ?? 'collection_template.webp')) }}"
                                alt="{{ collection.name }}"
                                class="rounded-lg mb-3 h-32 w-full object-cover shadow-sm border border-grey-800 hover:opacity-90 transition-opacity duration-200">
                        </a>
                            <a href="{{ path('liste_show', { id: collection.id }) }}"
                            class="block w-fit transition-colors relative after:content-[''] after:absolute after:left-0 after:-bottom-0.5 after:h-0.5 after:w-0 after:bg-purple-500 after:transition-all after:duration-300 hover:after:w-full hover:text-purple-500 active:scale-95 active:after:bg-purple-600">
                                <h3 class="text-2xl font-bold mb-2 truncate text-white hover:text-purple-500 active:text-purple-600">
                                    {{ collection.name }}
                                </h3>
                            </a>
                        <p class="text-xs italic text-grey-400">
                            Par 
                            {% if collection.usser is not null %}
                                <a href="{{ path('app_profil_visiteur', { id: collection.usser.id }) }}"
                                class="text-blue-600 hover:underline hover:text-blue-400 transition-colors">
                                    {{ collection.usser.name }}
                                </a>
                            {% else %}
                                <span class="text-red-400 italic">Utilisateur supprimé</span>
                            {% endif %}
                        </p>
                        <p class="text-sm text-grey-400 truncate">
                            {{ collection.description|default('Aucune description') }}
                        </p>
                    </div>

                    <div class="mt-4 flex justify-between text-xs text-grey-500">
                        <span>{{ collection.dateCreation|date('d/m/Y') }}</span>
                        <span>{{ collection.favorisCount }} favoris</span>
                    </div>
                </div>
            {% endfor %}
        </div>
    {% else %}
        <p class="text-sm italic text-grey-400">Aucune collection en favoris pour le moment.</p>
    {% endif %}


    <!-- Séparateur -->
    <div class="w-full h-px bg-grey-500 opacity-30 my-6"></div>

        <!-- Statistiques personnelles -->
        <div class="w-full mb-4">
            <h2 class="text-xl sm:text-2xl font-semibold dark:text-white text-black-950">Mon activité</h2>
        </div>

        <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-5 gap-4 text-center text-black-950 dark:text-white">
            <div class="bg-white dark:bg-black-900 rounded-lg shadow p-4 tilt-card">
                <p class="text-3xl font-bold">{{ user.listes|length }}</p>
                <p class="text-sm text-grey-500">Collections créées</p>
            </div>
            <div class="bg-white dark:bg-black-900 rounded-lg shadow p-4 tilt-card">
                <p class="text-3xl font-bold">{{ user.posts|length }}</p>
                <p class="text-sm text-grey-500">Commentaires postés</p>
            </div>
            <div class="bg-white dark:bg-black-900 rounded-lg shadow p-4 tilt-card">
                <p class="text-3xl font-bold">{{ user.reponse|length }}</p>
                <p class="text-sm text-grey-500">Réponses envoyées</p>
            </div>
            <div class="bg-white dark:bg-black-900 rounded-lg shadow p-4 tilt-card">
                <p class="text-3xl font-bold">{{ user.sousPosts|length }}</p>
                <p class="text-sm text-grey-500">Commentaires likés</p>
            </div>
            <div class="bg-white dark:bg-black-900 rounded-lg shadow p-4 tilt-card">
                <p class="text-3xl font-bold">{{ user.favoris|length }}</p>
                <p class="text-sm text-grey-500">Collections en favoris</p>
            </div>
        </div>

</section>

<script type="module" data-reload>
    import initAddonScript from '{{ asset("js/profil/profilModal.js") }}';
    initAddonScript();
</script>
<script type="module" data-reload>
    import initAddonScript from '{{ asset("js/profil/profilImgLum.js") }}';
    initAddonScript();
</script>
<script type="module" data-reload>
    import initAddonScript from '{{ asset("js/profil/profilSideBarre.js") }}';
    initAddonScript();
</script>
<script type="module" data-reload>
    import initAddonScript from '{{ asset("js/asset/orIcon.js") }}';
    initAddonScript(20);
</script>
{% endblock %}
